<?xml version="1.0" encoding="UTF-8" ?>
<!-- mapper DTD 선언 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mapper자체가 DAO 분리되어 나온 개념이기 때문에 namespace는 DAO명을 따라가는 경우가 일반적임 -->
<mapper namespace="PlaceDAO">
	
	<insert id="insertPlace">
	<![CDATA[

 INSERT INTO PLACE( 
					P_SEQ
					, P_CATEGORY
					, P_AREA
					, P_NAME
					, P_ADDRESS
					, P_TELL
					, P_INFO
					, P_IMG_PATH
					, P_X_AXIS
					, P_Y_AXIS
					)

VALUES(
					(SELECT IFNULL(MAX(P_SEQ), 0) + 1 FROM PLACE A)
					 , #{pCategory}
					 , #{pArea}
					 , #{pName}
					 , #{pAddress}
					 , #{pTell}
					 , #{pInfo}
					 , #{pImgpath}
					 , #{pXaxis}
					 , #{pYaxis})
					 
					 
					 
					 
	]]>
	</insert>

	
	<update id="updatePlace">
		<![CDATA[

			UPDATE PLACE SET
				
				  P_AREA = #{pArea}
				, P_NAME =  #{pName}
				, P_ADDRESS =  #{pAddress}
				, P_TELL =  #{pTell}
				, P_INFO = #{pInfo}
				, P_IMG_PATH =  #{pImgpath}
				, P_X_AXIS = #{pXaxis}
				, P_Y_AXIS = #{pXaxis}
			WHERE P_SEQ = #{pSeq}
			
			
			
			
		]]>
	</update>
	
	<delete id="deletePlace" >
		<![CDATA[

			DELETE FROM `randomjeju`.`place`
			WHERE P_SEQ = #{pSeq}
			
		]]>
	</delete>
	
	<select id="getPlace" resultType="place">
		<![CDATA[
		SELECT * FROM PLACE
			WHERE P_SEQ = #{pSeq}
		]]> 
	</select>
	
	<select id="getPlaceList" resultType="place">
		<![CDATA[
		SELECT * FROM PLACE
		]]> 
	</select>
	
	<select id="getPlaceSeq" resultType="int">
		SELECT IFNULL(MAX(P_SEQ) ,0) + 1
			FROM PLACE
	</select>
	
	<insert id="insertPlaceFileList" parameterType="placeFile">
		
		INSERT INTO PLACE_FILE (
									SEQ,
									F_SEQ,
									ORIGINAL_FILE_NAME,
									FILE_PATH,
									FILE_SIZE
								)
						VALUES (
									#{seqq},
									(
										SELECT IFNULL(MAX(F_SEQ), 0) + 1
											FROM PLACE_FILE A
										WHERE SEQ = #{seqq}
									),
									#{originalFileName},
									#{filePath},
									#{fileSize}
								)
							
	</insert>
	
	<select id="getPlaceFileList" parameterType="int" resultType="placeFile">
		SELECT * FROM PLACE_FILE
			WHERE SEQ = #{seq}
	</select>
	
	<delete id="deleteFile" parameterType="placeFile">
		DELETE FROM PLACE_FILE
			WHERE SEQ = #{seq}
			  AND F_SEQ = #{fSeq}
	</delete>
	
	<delete id="deleteFileList" parameterType="int">
		DELETE FROM PLACE_FILE
			WHERE SEQ = #{seq}
	</delete>
	
	
	<select id="getCafeList" resultType="place">
		<![CDATA[
		SELECT * FROM PLACE
		WHERE P_CATEGORY = '카페'
		]]>

	</select>
	
	
	<select id="getRestaurantList" resultType="place">
		<![CDATA[
		SELECT * FROM PLACE
		WHERE P_CATEGORY = '음식점'
		]]>
	</select>
	
	
	<select id="getRoomsList" resultType="place">
		<![CDATA[
		SELECT * FROM PLACE
		WHERE P_CATEGORY = '숙소'
		]]>

	
	</select>
	<select id="getTourList" resultType="place">
		<![CDATA[
		SELECT * FROM PLACE
		WHERE P_CATEGORY = '관광지'
		]]>
	</select>
	
</mapper>
